<tool id="rej" name="rejuve" version="0.1.0+galaxy0" python_template_version="3.5" profile="21.05">
    <requirements>
    </requirements>
 
    <command detect_errors="exit_code"><![CDATA[
    python '$__tool_directory__/args.py'
    #if $service.select == 'qb'

        ## get nodes
        #if $service.nodes
        #set $nodes = ''
        ## TODO: add an implicit key value iterator 
        #set $nodes_str = " ".join(['"%s"' % (",".join([str($node.id),str($node.type),str($node.properties)])) for $node in $service.nodes])
        --nodes  $nodes_str
        #end if

        ## get edges
        #if $service.edges
        #set $edges = ''
        #set $edges_str = " ".join(['"%s"' % (",".join([str($edge.source),str($edge.type),str($edge.target)])) for $edge in $service.edges])
        --edges  $edges_str
        #end if

        #elif $service.select == 'nl'
        -prompt $service.prompt
        #end if

        #*
        #set $nodes = []
        #for $index, $value in enumerate($service.nodes)
            #set $field = {}
            $field.append(str($value.id))
            $field.append(str($value.type))
            $field.append(str($value.properties))
            #set $dummy = $nodes.append(str($field))
        #end for
        *#
        #* wont take id as a key
        #set $nodes = []
        #for $index, $value in enumerate($service.nodes)
            #set $field = {}

            $field["id"]=${value.id}
            $field["type"]=${value.type}
            $field["properties"]=${value.properties}
            
            #set $dummy = $nodes.append(str($field))
        #end for
        *#
        ## #set $result_string = ", ".join($nodes)
        ## -query $result_string

    > '$out'
    ]]></command>

    <inputs>

            <param name="GALAXY_URL" type="baseurl" value="/tool_runner/biomart" />

        <conditional name="service">

            <param type="select" name="select" label="Service">
                    <option value="qb">Query Builder</option>
                    <option value="nl">Prompt</option>
            </param>

            <when value="nl">
                <param type="text" format="data" name="prompt" label="Text" />
            </when>


            <when value="qb">

                <repeat name="nodes">
                        <param type="text" format="str"  name="id" label="Id" />
                        
                        <param type="text" format="str" name="type" label="Type" />
                                
                        <param type="text" format="str" name="properties" label="Properties" />      
                </repeat>

                <repeat name="edges">
                    <param type="text" format="str"  name="type" label="Type" />
                        
                    <param type="text" format="str" name="source" label="Source" />
                            
                    <param type="text" format="str" name="target" label="Target" /> 
                </repeat>
        

                
            </when>

        </conditional>

    </inputs>

    <outputs>
     <data name="out" format="txt" label="Export logs"/>
    </outputs>

    <help><![CDATA[
    TODO: Fill in help.
    ]]></help>
</tool>